I will create a new C++17 template-based Service framework in `wrapper-esp32/src/app/service.hpp`.

### Design Philosophy
The design will be a generic, thread-safe `Service<ReqT, ResT>` abstract class that implements a Producer-Consumer pattern using FreeRTOS primitives.

1.  **Generics**: Uses C++ templates to allow any data type for Requests and Responses (e.g., `std::vector<uint8_t>`, custom structs, or smart pointers for large media frames).
2.  **Thread Safety**: 
    -   **Input Queue**: Receives requests from external threads.
    -   **Output Queue**: Stores results for retrieval.
    -   FreeRTOS Queues (`xQueueSend/Receive`) provide native thread safety and blocking mechanisms.
3.  **Lifecycle Management**: 
    -   Internal State Machine: `Stopped` -> `Idle` <-> `Processing`.
    -   Controlled `Start()` and `Stop()` methods with resource cleanup.
4.  **Async/Sync Hybrid**:
    -   `Request()` is non-blocking (unless queue is full).
    -   `WaitResponse()` allows the caller to block until data is ready, facilitating synchronization.
5.  **Extensibility**: Pure virtual `Process()` method for specific logic (Codec, etc.).

### Implementation Steps
1.  **Create File**: `wrapper-esp32/src/app/service.hpp`.
2.  **Define Class**:
    -   `template <typename ReqT, typename ResT> class Service`
    -   **Config**: Struct to define Stack Size, Priority, Queue Depths, Core Affinity.
    -   **API**:
        -   `bool Start(const Config& config)`
        -   `void Stop()`
        -   `bool Request(const ReqT& req, TickType_t wait = 0)`
        -   `bool WaitResponse(ResT& res, TickType_t wait = portMAX_DELAY)`
    -   **Internal**:
        -   Static task function `TaskWrapper`.
        -   Virtual `Process` method.
3.  **Code Structure**:
    -   Use `std::atomic` for state flags.
    -   Use `xQueueCreate` / `vQueueDelete`.
    -   Use `xTaskCreatePinnedToCore`.
    -   Use C++17 `[[nodiscard]]` and `constexpr` where appropriate.

This design is standalone, modern, and fits the "Service" abstraction perfectly for the described use cases.