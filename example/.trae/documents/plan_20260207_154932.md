I will generate the Cardputer configuration code in `src/app/main/app_main.cpp` based on the peripherals identified in `todo/cardputer/info.md`.

**1. Analyze Peripherals & Required Configs**

*   **Display (ST7789V2)**:
    *   Already done (`SpiDisplayConfig spi_display_config`).
    *   Need `SpiBusConfig` (Already updated).
*   **MicroSD Socket**:
    *   Pins: CS=G12, MOSI=G14, CLK=G40, MISO=G39.
    *   Needs `SpiBusConfig` (for SD) or `SdMmcConfig`. Since pins are standard SPI, likely SPI mode.
    *   However, `wrapper/sd.hpp` is missing (error in previous turn). I should check if there is an `SdCard` wrapper or similar. The file list showed `src/wrapper/sdspi.hpp` or similar might exist, or maybe I missed it.
    *   I will search for SD card wrapper files.
*   **I2S Speaker (NS4168) & Mic (SPM1423)**:
    *   Speaker: BCLK=G41, SDATA=G42, LRCLK=G43.
    *   Mic: DAT=G46, CLK=G43 (Shared LRCLK/CLK?). Wait, Speaker LRCLK is G43, Mic CLK is G43. Speaker BCLK G41.
    *   This looks like they might share the I2S bus or use different slots? Or maybe Mic uses PDM?
    *   SPM1423 is PDM. NS4168 is I2S (MAX98357A compatible often).
    *   I need `I2sBusConfig` and `I2sChan...Config`.
*   **I2C (Grove/HY2.0-4P)**:
    *   SDA=G2, SCL=G1.
    *   Needs `I2cBusConfig`.
*   **Keyboard (Matrix)**:
    *   Rows: G13, G15, G3, G4, G5, G6, G7.
    *   Cols (74HC138): A0=G8, A1=G9, A2=G11.
    *   This requires GPIO configs. I need to find the GPIO wrapper or just use raw GPIO APIs if no wrapper exists (but the rule says "use wrapper"). I tried reading `wrapper/gpio.hpp` and it failed. I will check for `wrapper/gpio.h` or similar.
*   **IR Tx**:
    *   Pin: G44.
    *   Needs RMT or just GPIO? Usually RMT. I'll check for RMT wrapper.

**2. Missing Wrappers Check**
*   `wrapper/sd.hpp` -> Failed.
*   `wrapper/gpio.hpp` -> Failed.
*   I will `Glob` `src/wrapper` to see available wrappers.

**3. Generate Code in `app_main.cpp`**
*   Add `I2cBusConfig`.
*   Add `I2sBusConfig` (Speaker).
*   Add `I2sBusConfig` (Mic) - check if they can coexist or share.
*   Add comments for missing wrappers (SD, Keyboard, IR).

**Revised Plan:**
1.  **List Wrappers**: Run `Glob` on `src/wrapper` to confirm available headers.
2.  **Generate Configs**:
    *   `I2cBusConfig i2c_bus_config` (SDA=2, SCL=1).
    *   `I2sBusConfig i2s_bus_config` (Speaker: BCLK=41, WS=43, DOUT=42).
    *   Note: Mic (G46/G43) might need a separate I2S port or PDM RX config.
3.  **Update `app_main.cpp`**: Append these configs inside `#if CONFIG_WRAPPER_ESP32_BOARD_M5STACK_CARDPUTER`.

Let's do this.