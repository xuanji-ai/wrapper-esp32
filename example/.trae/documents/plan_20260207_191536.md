I will implement the `board_init` function in `app_main.cpp` for the `CONFIG_WRAPPER_ESP32_BOARD_M5STACK_CARDPUTER` section. This will involve instantiating and initializing the configured devices (SPI Bus, Display, I2C Bus, I2S Speaker, I2S Mic) and performing simple tests.

**1. Logger Instantiation**

* Create loggers for each subsystem: `logger_spi`, `logger_display`, `logger_i2c`, `logger_i2s_spk`, `logger_i2s_mic`, `logger_spk_codec`, `logger_mic_codec`.

**2. SPI Bus & Display Initialization**

* Instantiate `SpiBus`.

* Instantiate `SpiDisplay` (using `ST7789` panel driver logic if available, or just generic init).

* The user provided `SpiDisplayConfig` but `SpiDisplay::Init` needs a `new_panel_func`. For ST7789, I usually need `esp_lcd_new_panel_st7789`. I need to include `<esp_lcd_panel_ops.h>` and `<esp_lcd_panel_st7789.h>` if available, or just rely on generic panel init if the wrapper handles it (Wrapper requires `new_panel_func`).

* I'll search for `st7789` in the codebase to see if there's a helper or if I need to include the IDF header.

**3. I2C Bus Initialization**

* Instantiate `I2cBus`.

* Initialize it with `i2c_bus_config`.

**4. I2S Speaker Initialization**

* Instantiate `I2sBus` (`i2s_bus_0`).

* Init with `i2s_speaker_bus_cfg`.

* Configure Tx Channel with `i2s_speaker_chan_cfg`.

* Instantiate `Speaker` (using `NS4168` logic). Wait, `NS4168` is just an I2S amp, no I2C control. So `Speaker` class (no codec) is appropriate.

* Init `Speaker` with `i2s_bus_0`.

* Test: Play a tone.

**5. I2S Mic Initialization**

* Instantiate `I2sBus` (`i2s_bus_1`).

* Init with `i2s_mic_bus_cfg`.

* Configure Rx Channel with `i2s_mic_chan_cfg`.

* Instantiate `Microphone` (SPM1423 is PDM, no I2C).

* Init `Microphone` with `i2s_bus_1`.

* Test: Record and print volume/data? Or loopback to speaker?

**6. Loopback Test (Optional but good)**

* Read from Mic, Write to Speaker.

**Implementation Plan Details:**

* Add necessary includes (`esp_lcd_panel_st7789.h`).

* Implement `board_init`:

  * Initialize Loggers.

  * Initialize Buses (SPI, I2C, I2S0, I2S1).

  * Initialize Devices (Display, Speaker, Mic).

  * Run a sequence:

    * Display: Turn on, Fill color.

    * Speaker: Play tone.

    * Mic: Record (maybe just log "Mic Init OK").

**Note on Configs:**

* I need to make sure `spi_bus_config` etc. are passed correctly.

* The `SpiDisplay::Init` signature requires a lambda/function pointer for panel creation. I'll use `esp_lcd_new_panel_st7789`.

Let's check if `esp_lcd_panel_st7789.h` is available. It should be part of `esp_lcd` component in IDF.

**Refined Plan:**

1. Add includes.
2. Write `board_init` body.
3. Add simple test logic.

