I have analyzed `keyboard.h`, `keymap.h`, and `keyboard.cpp`. Here is the assessment and optimization plan:

**Analysis of Code Norms & Issues:**

1.  **Header Guards:** `keyboard.h` uses `#pragma once` (good), `keymap.h` uses `#ifndef` (good). Consistent usage is preferred, but both work.
2.  **Namespace:** Uses `KEYBOARD` namespace.
3.  **Hardcoded Pins:** `output_list` and `input_list` in `keyboard.h` (lines 32-33) define pin numbers directly in the header. This is bad practice; configuration should be separated from logic.
4.  **Global Constants:** `X_map_chart` and `_key_value_map` are defined in the header. If included in multiple files, this causes multiple definition errors. They should be `extern` in header and defined in `.cpp`, or `inline constexpr`.
5.  **Struct Naming:** `Chart_t`, `Point2D_t`, `KeyValue_t` use `_t` suffix, which is common but inconsistent with `Keyboard` class naming style.
6.  **Methods:**
    *   `init()`: Uses raw GPIO calls.
    *   `getKey()`: Scans matrix.
    *   `updateKeyList()`: Similar to `getKey()` but updates a list. Code duplication.
    *   `updateKeysState()`: Uses `strcmp` excessively to identify special keys. This is slow and fragile.
7.  **Efficiency:**
    *   Matrix scanning uses `digitalWrite`/`digitalRead` macros wrapping `gpio_set_level`/`gpio_get_level`. This is fine.
    *   `updateKeysState` iterates and does string comparisons for every key press. It should check `value_num` (HID code) or a flag instead of string "shift", "ctrl", etc.
8.  **String usage:** `std::vector<char> values` stores characters. `KeyValue_t` stores `const char*`.
9.  **Macros:** `digitalWrite`/`digitalRead` macros in `.cpp` are okay but C++ style `static inline` functions or direct calls are cleaner.

**Optimization Suggestions:**

1.  **Fix ODR Violations:** Move definitions of `output_list`, `input_list`, `X_map_chart`, `_key_value_map` to `.cpp` or make them `inline constexpr`.
2.  **Configuration Separation:** Pass pin lists to the constructor instead of hardcoding in header.
3.  **Optimize Special Key Detection:** Use an enum or check `value_num` (HID code) instead of `strcmp("shift", ...)` in `updateKeysState()`.
4.  **Refactor Scanning:** Combine `getKey` and `updateKeyList` logic if possible, or make them share the scan routine.
5.  **Modern C++:** Use `std::array` instead of raw arrays where appropriate. Use `enum class` for key types if needed.
6.  **Style:** Standardize naming (CamelCase vs snake_case).

**Plan:**

1.  **Refactor `keyboard.h`**:
    *   Make `output_list`, `input_list` members of `Keyboard` class, initialized in constructor.
    *   Move `X_map_chart` and `_key_value_map` to `keyboard.cpp` (as private static const data) to avoid header bloat and multi-definition errors.
    *   Remove `strcmp` dependency by using HID codes or enum checks for special keys.

2.  **Refactor `keyboard.cpp`**:
    *   Implement constructor to accept pins (optional, but good for portability). For now, keep hardcoded but move to `.cpp` to clean header.
    *   Optimize `updateKeysState` to switch on `hidKey` or `value_num` instead of string comparison.
    *   Clean up `init()` to use the class pin members.

3.  **Code Cleanup**:
    *   Remove commented out code.
    *   Use `const` correctness.

I will focus on **Code Structure Improvement** (moving data to cpp) and **Performance/Logic Optimization** (removing strcmp).

**Proposed Changes:**
1.  **`keyboard.h`**: Remove definitions of maps/lists. Declare them or make them private members.
2.  **`keyboard.cpp`**: Define maps/lists here. Rewrite `updateKeysState` to use HID codes.

**Wait**, `keymap.h` defines `KEY_LSHIFT` etc. I can use these to detect special keys!
e.g. `if (getKeyValue(i).value_num_first == KEY_TAB) ...`
This is much faster than `strcmp`.

I will implement these optimizations.